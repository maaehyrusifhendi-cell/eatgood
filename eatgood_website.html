<!-- 24-Hour Dietary Recall Section -->
<section id="recall" style="background:#ffffff;">
  <h3 style="text-align:center;font-size:2em;color:#2e7d32;">24-Hour Dietary Recall</h3>

  <div class="card" style="max-width:700px;margin:0 auto;">
    <p style="margin-bottom:10px;">
      Enter everything the client ate or drank during the last 24 hours.  
      The calculator totals calories for each meal and for the day.
    </p>

    <table id="recallTable" style="width:100%;border-collapse:collapse;">
      <thead>
        <tr style="background:#2e7d32;color:#fff;">
          <th>Meal</th>
          <th>Food Item</th>
          <th>Portion (g)</th>
          <th>Energy/100 g (kcal)</th>
          <th>Total Energy (kcal)</th>
        </tr>
      </thead>
      <tbody></tbody>
      <tfoot>
        <tr style="font-weight:bold;background:#e8f5e9;">
          <td colspan="4">Daily Total Energy (kcal)</td>
          <td id="dailyTotal">0</td>
        </tr>
      </tfoot>
    </table>

    <div style="margin-top:10px;text-align:center;">
      <button onclick="addRecallRow()">Add Meal Item</button>
      <button onclick="clearRecall()">Reset</button>
    </div>
  </div>
</section>

<script>
  function addRecallRow() {
    const tbody = document.querySelector("#recallTable tbody");
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>
        <select>
          <option>Breakfast</option>
          <option>Snack AM</option>
          <option>Lunch</option>
          <option>Snack PM</option>
          <option>Dinner</option>
          <option>Other</option>
        </select>
      </td>
      <td><input type="text" placeholder="e.g., Rice & stew"></td>
      <td><input type="number" value="100" min="1" style="width:70px"></td>
      <td><input type="number" value="200" min="0" style="width:90px"></td>
      <td class="mealEnergy">0</td>
    `;
    tbody.appendChild(tr);

    // Recalculate when any number changes
    tr.querySelectorAll('input[type="number"]').forEach(inp =>
      inp.addEventListener('input', () => updateRecallTotals())
    );
    updateRecallTotals();
  }

  function updateRecallTotals() {
    const rows = document.querySelectorAll("#recallTable tbody tr");
    let daily = 0;
    rows.forEach(r => {
      const portion = parseFloat(r.children[2].querySelector('input').value) || 0;
      const energy100 = parseFloat(r.children[3].querySelector('input').value) || 0;
      const total = (portion * energy100) / 100;
      r.querySelector(".mealEnergy").textContent = total.toFixed(1);
      daily += total;
    });
    document.getElementById("dailyTotal").textContent = daily.toFixed(1);
  }

  function clearRecall() {
    document.querySelector("#recallTable tbody").innerHTML = "";
    document.getElementById("dailyTotal").textContent = "0";
  }

  // initialise with one blank row
  addRecallRow();
</script>
